var __test_log={};var __test_ver=11;var __test_log_cnt=1;function setCookie(b,e,a,g,d,f){var c=b+"="+encodeURIComponent(e)+((a)?"; expires="+a.toUTCString():"")+((g)?"; path="+g:"")+((d)?"; domain="+d:"")+((f)?"; secure":"");document.cookie=c}function getCookie(c){var b=document.cookie;var e=c+"=";var d=b.indexOf("; "+e);if(d==-1){d=b.indexOf(e);if(d!=0){return null}}else{d+=2}var a=document.cookie.indexOf(";",d);if(a==-1){a=b.length}return decodeURIComponent(b.substring(d+e.length,a))}function deleteCookie(a,c,b){if(getCookie(a)){document.cookie=a+"="+((c)?"; path="+c:"")+((b)?"; domain="+b:"")+"; expires=Thu, 01-Jan-70 00:00:01 GMT"}}var prefs_ver=2;function setPrefCookie(a,g){var h=getCookie("__prefs"+prefs_ver);var j=new Object();if(h){var f=h.split("|");for(var e=0;e<f.length;e++){var c=f[e].match("(.*)=(.*)");j[c[1]]=c[2]}}j[a]=g;var d=new Array();for(var e in j){if(typeof j[e]!="function"){d.push(e+"="+j[e])}}var b=new Date();b.setTime(b.getTime()+3600*1000*24*365);setCookie("__prefs"+prefs_ver,d.join("|"),b,"/")}function getPrefCookie(d){var c=getCookie("__prefs"+prefs_ver);if(!c){return null}var b=c.split("|");for(var e=0;e<b.length;e++){var a=b[e].match("(.*)=(.*)");if(a[1]==d){return a[2]}}return null}function deletePrefCookie(e){var d=getCookie("__prefs"+prefs_ver);var g=new Object();if(d){var b=d.split("|");for(var f=0;f<b.length;f++){var a=b[f].match("(.*)=(.*)");if(a[1]!=e){g[a[1]]=a[2]}}}var h=new Array();for(var f in g){h.push(f+"="+g[f])}var c=new Date();c.setTime(c.getTime()+3600*1000*24*365);setCookie("__prefs"+prefs_ver,h.join("|"),c,"/")}if(typeof(Array.prototype.push)=="undefined"){Array.prototype.push=function(a){this[this.length]=a}}if(typeof(Array.prototype.indexOf)=="undefined"){Array.prototype.indexOf=function(b){for(var a=0;a<this.length;a++){if(this[a]==b){return a}}return -1}}if(!Array.prototype.filter){Array.prototype.filter=function(b){var a=this.length>>>0;if(typeof b!="function"){throw new TypeError()}var e=new Array();var d=arguments[1];for(var c=0;c<a;c++){if(c in this){var f=this[c];if(b.call(d,f,c,this)){e.push(f)}}}return e}}Number.prototype.format=function(){var a=Math.floor(this);if(a<10){return"0"+a}else{return a}};if(!Prototype.Browser.IE){document.captureEvents(Event.MOUSEMOVE)}document.onmousemove=getMouseXY;var mouseX=0;var mouseY=0;function getMouseXY(a){if(Prototype.Browser.IE){mouseX=event.clientX+document.documentElement.scrollLeft;mouseY=event.clientY+document.documentElement.scrollTop}else{mouseX=a.pageX;mouseY=a.pageY}if(mouseX<0){mouseX=0}if(mouseY<0){mouseY=0}return true}var WindowSize={};WindowSize.width=function(){var a=0;if(typeof(window.innerWidth)=="number"){a=window.innerWidth}else{if(document.documentElement&&document.documentElement.clientWidth){a=document.documentElement.clientWidth}else{if(document.body&&document.body.clientWidth){a=document.body.clientWidth}}}return a};WindowSize.height=function(){var a=0;if(typeof(window.innerHeight)=="number"){a=window.innerHeight}else{if(document.documentElement&&document.documentElement.clientHeight){a=document.documentElement.clientHeight}else{if(document.body&&document.body.clientHeight){a=document.body.clientHeight}}}return a};WindowSize.getPopupLeft=function(a){if(WindowSize.width()>a+mouseX+5-(document.body.scrollLeft?document.body.scrollLeft:document.documentElement.scrollLeft)){return mouseX+5+"px"}else{return mouseX-5-a+"px"}};WindowSize.getPopupTop=function(a){if(WindowSize.height()>a+mouseY+5-(document.body.scrollTop?document.body.scrollTop:document.documentElement.scrollTop)){return mouseY+5+"px"}else{return mouseY-5-a+"px"}};WindowSize.setPopupPos=function(a){a.style.left=WindowSize.getPopupLeft(a.getWidth());a.style.top=WindowSize.getPopupTop(a.getHeight())};function submitLogin(a,d){var c=document.createElement("FORM");var e=window.location;c.setAttribute("action","/login?redirect="+encodeURI(e));c.setAttribute("method","POST");var b=document.createElement("INPUT");b.setAttribute("name","login");b.setAttribute("value",a);b.setAttribute("type","hidden");c.appendChild(b);var b=document.createElement("INPUT");b.setAttribute("name","pass");b.setAttribute("value",d);b.setAttribute("type","hidden");c.appendChild(b);var b=document.createElement("INPUT");b.setAttribute("name","submit_login");b.setAttribute("value","1");b.setAttribute("type","hidden");c.appendChild(b);document.documentElement.appendChild(c);c.submit();$("register_block").hide()}function logout(){var b=document.createElement("FORM");b.setAttribute("method","POST");var a=document.createElement("INPUT");a.setAttribute("name","submit_logout");a.setAttribute("value",1);a.setAttribute("type","hidden");b.appendChild(a);document.documentElement.appendChild(b);b.submit()}function dbg(a){((window.console&&console.log)||(window.opera&&opera.postError)||window.alert).call(this,a)}function clone(c){if(c==null||typeof(c)!="object"){return c}if(c&&typeof c.length==="number"&&!(c.propertyIsEnumerable("length"))&&typeof c.splice==="function"){var a=new Array()}else{var a=new Object()}for(var b in c){a[b]=clone(c[b])}return a}function showProfile(id){return;var obj=$("popup");var content=$("popup_content");if(profilesCache[id]==undefined){content.update(strLoading);profilesCache[id]=0;new Ajax.Request("/profile/"+id+".popup",{method:"get",parameters:url_params,onSuccess:function(transport){eval("var json="+transport.responseText+";");profilesCache[json.id]=json.html;$("popup_content").update(profilesCache[json.id])}})}else{if(profilesCache[id]!=0){content.update(profilesCache[id])}}obj.style.left=mouseX+10+"px";obj.style.top=mouseY+10+"px";obj.show()}function changeGametypeClick(){$("gametype-link").hide();var a=$("gametype-select");a.show();a.absolutize();a.style.width="auto";a.style.height="auto";a.focus()}function changeGametypeBlur(){$("gametype-select").hide();$("gametype-link").show()}function changeGametypeSelect(){var b=$("gametype-select");var f=$("gametype-link");b.hide();var g="";var c="";for(var d=0;d<b.options.length;d++){if(b.options[d].selected){g=b.options[d].value;var a=b.options[d].innerHTML.match(/^(.*) \(\d+\)$/);c=a[1]}}f.update(c);var e=g;if(/voc-\d+/.test(e)){e="voc"}f.className="gametype-"+e;$("gametype-mdash").className="gametype-"+e;f.show();loadGametype(g)}function loadGametype(b){$("gametype-loading").show();new Ajax.Request("/.userinfo",{method:"post",parameters:{gametype:b},onSuccess:function(c){$("stats-block").update(c.responseText);$("gametype-loading").hide()}});var a=new Date();a.setTime(a.getTime()+7*24*3600*1000);setPrefCookie("stats_gametype",b)}function show_popup(a){$(a).setStyle({height:"2000px",width:$(document.body).getWidth()+"px"});if(Prototype.Browser.IE){$$("#"+a+" .back").each(function(b){$(b).setStyle({filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=50)"})})}$(a).show();$(a).select("input[type=button]")[0].focus()}var _popalert_callback=null;function popalert(b,a){if(!$("popalert")){setTimeout(function(){popalert(b,a)},300);return}_popalert_callback=null;if(a&&a.callback){_popalert_callback=a.callback}$("popalert-content").update(b);show_popup("popalert")}function popconfirm(a,b){if(!$("popconfirm")){setTimeout(function(){popconfirm(a,b)},300);return}$("popconfirm-content").update(a);$("popconfirm-btn-ok").onclick=function(){if(b==null){$("popconfirm").hide()}else{var c=b();if(c){$("popconfirm-btn-ok").disabled=true}else{$("popconfirm").hide()}}};$("popconfirm-btn-ok").disabled=false;show_popup("popconfirm")}function getImgOriginalWidth(b){var a=new Image();a.src=(b.getAttribute?b.getAttribute("src"):false)||b.src;return a.width}Number.prototype.toHex=function(){var a=this.toString(16);if(a.length<2){a="0"+a}return a};colortools=function(){};colortools.getBrightness=function(c){var e=parseInt(c.substr(1,2),16);var d=parseInt(c.substr(3,2),16);var a=parseInt(c.substr(5,2),16);return(e*299+d*587+a*114)/1000/255};colortools.capByBrightness=function(c,d){if(d==undefined){d=0.5}var i=colortools.getBrightness(c);if(i<=d){return c}var f=parseInt(c.substr(1,2),16);var e=parseInt(c.substr(3,2),16);var a=parseInt(c.substr(5,2),16);var h=i-d;f-=f*h;a-=a*h;e-=e*h;return"#"+parseInt(f).toHex()+parseInt(e).toHex()+parseInt(a).toHex()};var _top_popup_close_callback=null;var _top_popup_btn_callback=null;function top_popup(d,b,a,c){$$("#top-popup .content").each(function(e){e.update(d)});if(b){$$("#top-popup .right input").each(function(e){e.value=b;e.show()})}else{$$("#top-popup .right input").each(function(e){e.hide()})}_top_popup_close_callback=c;_top_popup_btn_callback=a;$("top-popup").show();new Effect.Move("top-popup",{x:0,y:0,mode:"absolute"})}function close_top_popup(){new Effect.Move("top-popup",{x:0,y:-50,mode:"relative"});if(typeof _top_popup_close_callback=="function"){_top_popup_close_callback()}}function IEAlert(){if(!getCookie("IEAlert")){$("top-popup").style.position="absolute";top_popup("Вы используете браузер Internet Explorer версии 6.0 или ниже. Это устаревшая версия браузера, в которой некоторые функции сайта могут работать некорректно.","Обновить Internet Explorer",function(){window.location="http://www.microsoft.com/rus/windows/internet-explorer/default.aspx"},function(){var a=new Date();a.setTime(a.getTime()+3*3600*1000);setCookie("IEAlert",1,a,"/")})}}function OperaAlert(){if(!getCookie("OperaAlert")){top_popup("Вы используете браузер Opera устаревшей версии, некоторые функции сайта могут работать некорректно. Пожалуйста, обновите браузер для увеличения производительности.","Обновить Opera",function(){window.location="http://ru.opera.com/"},function(){var a=new Date();a.setTime(a.getTime()+3*24*3600*1000);setCookie("OperaAlert",1,a,"/")})}}var invite=null;var closed_invites=new Array();var invite_timeout_interval=null;function showInvite(){if(closed_invites.indexOf(invite.timestamp)!=-1){return}if(invite.gamestatus=="racing"){return}var d="";if(invite.invited_by.avatar){d="style=\"padding-left: 20px; background: transparent url('"+invite.invited_by.avatar+"') no-repeat 0% 0%;\""}var f="";if(invite.type=="normal"){f="открытой игре"}if(invite.type=="private"){f="игре с друзьями"}var c="";var g='<span style="font-size: 13px;">Пользователь <a href="/profile/'+invite.invited_by.id+'/" '+d+">"+invite.invited_by.login+"</a> приглашает вас присоединиться к "+f+" "+invite.gametype_html+"."+c+"</span>";var b="Присоединиться";var a=function(){new Ajax.Request("/play/"+invite.game_id+".inviteReceive");window.location="/play/?gmid="+invite.game_id};var e=function(){closed_invites.push(invite.timestamp);new Ajax.Request("/play/"+invite.game_id+".inviteReceive")};top_popup(g,b,a,e)}var mail_popup=null;function showMailPopup(){var c='<span style="font-size: 13px;">Вам пришло личное сообщение от пользователя '+mail_popup.name+".</span>";var b="Прочитать";var a=function(){window.location="/profile/"+__user__+"/mail/in/"};top_popup(c,b,a)}function initLoginForm(){$$("#login-form .close").last().observe("click",function(){$("login-form").hide()})}function changePin(){if(getPrefCookie("userpanel_pinned")){deletePrefCookie("userpanel_pinned");$$(".userpanel").last().style.position="static";$("pin").removeClassName("active");$("userpanel-dummy").hide()}else{var a=new Date();a.setTime(a.getTime()+3*365*24*3600*1000);setPrefCookie("userpanel_pinned",1);$$(".userpanel").last().style.position="fixed";$("pin").addClassName("active");$("userpanel-dummy").show()}}Effect.NumberChange=Class.create();Object.extend(Object.extend(Effect.NumberChange.prototype,Effect.Base.prototype),{initialize:function(b,d){var a=arguments[2]||{};this.element=$(b);this.startVal=parseInt(this.element.innerHTML);this.finishVal=d;this.delta=(this.finishVal-this.startVal);var c=Math.abs(this.delta*1.5/100);a.duration=a.duration||(c>2?2:c);this.start(a)},update:function(a){var b=parseInt(this.startVal+(this.delta*a)).toString();Element.update(this.element,b)}});function pluralForm(d,b,a,c){d=Math.abs(d)%100;n1=d%10;if(d>10&&d<20){return c}if(n1>1&&n1<5){return a}if(n1==1){return b}return c}String.prototype.encodeHTMLEntities=function(){var a=this;a=a.replace(/\&/g,"&amp;");a=a.replace(/\</g,"&lt;");return a};function checkCompetitionAlert(timeout,tryNum){if(__user_prefs&&__user_prefs.popup&&!__user_prefs.popup.competitions){return}if(tryNum>5){return}setTimeout(function(){new Ajax.Request("/ajax/check-competition",{onSuccess:function(transport){eval("var json="+transport.responseText+";");if(json.result=="ok"){if(game&&game.id==json.info.game_id){return}top_popup("<span class=bitmore>Соревнование по расписанию с рейтингом <strong>x"+json.info.rate+"</strong> скоро начнется.</span>","Войти в игру",function(){window.location="/play/?gmid="+json.info.game_id},null);setTimeout(function(){close_top_popup()},30000)}else{checkCompetitionAlert(0,tryNum+1)}}})},timeout*1000+10000)}function tlog(c,b){if(!__testmode){return}var a=new Date;if(!b){b=null}__test_log[__test_log_cnt+" ["+a.toString()+"] "+c]=clone(b);__test_log_cnt++}if(typeof(JSON)=="undefined"||typeof(JSON.stringify)=="undefined"){var JSON={};JSON.stringify=function(a){return Object.toJSON(a)}}else{delete Array.prototype.toJSON;delete Object.prototype.toJSON;delete Number.prototype.toJSON;delete String.prototype.toJSON}function showTestLog(){if(!__testmode){return}var b={URL:document.location.href,remote_addr:__remote_addr,browsers:clone(Prototype.Browser),prefs:getCookie("__prefs2").split("|"),log:__test_log};var a=window.open("about:blank","testlog","width=500,height=300,toolbar=no,status=no,scrollbars=yes,location=no,menubar=yes");a.document.write("<html><body>Версия лога: "+__test_ver+"<br>"+JSON.stringify(b).encodeHTMLEntities()+"</body></html>");a.focus()}function __dump_item(b,c,f){var e="";var d="";for(var a=0;a<f+1;a++){d+="      "}if(typeof(c)=="object"){if(c===null){e+="\n"+d+"[:i]"+b+"[/:i] => [i]null[/i]"}else{e+="\n"+d+"[:i]"+b+"[/:i] [richinfo "+(f+1)+"]";e+=dump(c,f+1);e+="[/richinfo "+(f+1)+"]"}}else{if(typeof(c)!="function"){e+="\n"+d+"[:i]"+b+"[/:i] => "+c+""}}return e}function dump(a,g){var f="";var e="";if(!g){g=0}for(var b=0;b<g+1;b++){f+="      "}if(typeof(a)=="object"){for(var c in a){if(typeof(a[c])=="function"){continue}var d=a[c];if(typeof(d)=="object"){if(d===null){e+="\n"+f+"[:i]"+c+"[/:i] => [i]null[/i]"}else{e+="\n"+f+"[:i]"+c+"[/:i] [richinfo "+(g+1)+"]";e+=dump(d,g+1);e+="[/richinfo "+(g+1)+"]"}}else{if(typeof(d)!="function"){e+="\n"+f+"[:i]"+c+"[/:i] => "+d+""}}}}else{e="===>"+a+"<===("+typeof(a)+")"}if(g==0){return"[richinfo "+g+"]"+e+"[/richinfo "+g+"]"}else{return e}}Ajax.Responders.register({onCreate:function(b){if(b.options.timeout){b.timeoutId=window.setTimeout(function(){if(b.transport.readyState>=1&&b.transport.readyState<=3){b.transport.abort();if(b.options.onFailure){b.options.onFailure(b.transport,b.json)}}},b.options.timeout)}if(b.options.tries&&b.options.tries>1){var a=b.options.onFailure?b.options.onFailure:null;b.options.onFailure=function(d,c){setTimeout(function(){var e=b.options;e.tries--;e.onFailure=a;new Ajax.Request(b.url,e)},500)}}},onComplete:function(a){if(a.options.timeout){window.clearTimeout(a.timeoutId)}}});function getMovie(a){if(navigator.appName.indexOf("Microsoft")!=-1){return window[a]}else{return document[a]}}$selection={getText:function(){var a="";if(a=window.getSelection){a=window.getSelection().toString()}else{a=document.selection.createRange().text}return a}};function initBBWidgets(){$$(".hidetop").each(function(a){a.onclick=function(){var b=this.id.match(/hidetop-(.+)/);if(this.nextSibling.id=="hidecont-"+b[1]){Effect.toggle(this.nextSibling,"slide",{duration:0.3})}this.toggleClassName("expanded")}})}$c=(function(){var b={};var a=0;return function(c){a++;return(b[c]||(b[c]=$(c)))}})();Effect.PlayerEnterRace=Class.create();Object.extend(Object.extend(Effect.PlayerEnterRace.prototype,Effect.Base.prototype),{initialize:function(b){var a=arguments[1]||{};this.element=$(b);this.startX=-40;this.finishX=0;this.startOpacity=0;this.finishOpacity=1;this.deltaX=(this.finishX-this.startX);this.deltaOpacity=(this.finishOpacity-this.startOpacity);a.duration=a.duration||1;a.transition=Effect.Transitions.linear;this.update(0);this.start(a)},update:function(b){var a=this.finishX-this.deltaX*Math.exp(-b*5);var c=this.finishOpacity-this.deltaOpacity*Math.exp(-b*5);if(b==1){a=this.finishX;c=this.finishOpacity}this.element.setStyle({left:a+"px",opacity:c})}});Effect.DropIn=function(b){b=$(b);var a={top:b.getStyle("top"),opacity:b.getInlineOpacity()};b.setStyle({top:parseFloat(b.getStyle("top"))-100+"px",opacity:0});return new Effect.Parallel([new Effect.MoveY(b,{y:100,sync:true}),new Effect.Opacity(b,{sync:true,from:0,to:1})],Object.extend({duration:0.5,beforeSetup:function(c){c.effects[0].element.makePositioned()},afterFinishInternal:function(c){c.effects[0].element.undoPositioned().setStyle(a)}},arguments[1]||{}))};Effect.DropOut=function(b){b=$(b);var a={top:b.getStyle("top"),left:b.getStyle("left"),opacity:b.getInlineOpacity()};return new Effect.Parallel([new Effect.MoveY(b,{y:100,sync:true}),new Effect.Opacity(b,{sync:true,to:0})],Object.extend({duration:0.5,beforeSetup:function(c){c.effects[0].element.makePositioned()},afterFinishInternal:function(c){c.effects[0].element.hide().undoPositioned().setStyle(a)}},arguments[1]||{}))};Effect.MoveY=Class.create(Effect.Base,{initialize:function(b){this.element=$(b);if(!this.element){throw (Effect._elementDoesNotExistError)}var a=Object.extend({y:0,mode:"relative"},arguments[1]||{});this.start(a)},setup:function(){this.element.makePositioned();this.originalTop=parseFloat(this.element.getStyle("top")||"0");if(this.options.mode=="absolute"){this.options.y=this.options.y-this.originalTop}},update:function(a){this.element.setStyle({top:(this.options.y*a+this.originalTop).round()+"px"})}});function drop_message(c,a){a=a||{};var b=$("drop_message").down(".popup-box");b.down(".c").update(c);new Effect.DropIn(b);$("drop_message").show();b.show();if(a.autohide){var d=setTimeout(function(){new Effect.DropOut(b)},a.autohide*1000)}$("drop_message").down(".close").onclick=function(){if(d){clearInterval(d)}new Effect.DropOut(b)}}function postUrl(a){var b=document.createElement("FORM");b.method="POST";b.action=a;$$("body")[0].appendChild(b);b.submit()};